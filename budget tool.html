<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daily Budget Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
      max-width: 500px;
      margin: auto;
    }
    h1 {
      text-align: center;
    }
    .balance {
      font-size: 1.8em;
      text-align: center;
      margin: 10px 0;
    }
    input, button {
      padding: 6px;
      margin: 4px 0;
      width: 100%;
    }
    .row {
      display: flex;
      gap: 5px;
    }
    .row input {
      flex: 1;
    }
    .log {
      max-height: 250px;
      overflow-y: auto;
      background: white;
      padding: 10px;
      border: 1px solid #ccc;
    }
    .entry {
      display: flex;
      gap: 5px;
      margin-bottom: 5px;
    }
    .entry input {
      flex: 1;
    }
    .entry button {
      width: 60px;
    }
  </style>
</head>
<body>

<h1>Daily Budget</h1>

<label>Daily Allowance ($)</label>
<input type="number" id="dailyBudget" step="0.01">

<div class="balance">
  Balance: $<span id="balance">0.00</span>
</div>

<h3>Add Transaction</h3>
<div class="row">
  <input id="nameInput" placeholder="Name">
  <input id="priceInput" type="number" step="0.01" placeholder="Price">
</div>
<button onclick="addTransaction()">Add</button>

<h3>Transactions</h3>
<div class="log" id="log"></div>

<script>
  const STORAGE_KEY = "budgetAppData";

  let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
    balance: 0,
    dailyBudget: 50,
    lastAllowanceDate: null,
    transactions: []
  };

  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  function updateUI() {
    document.getElementById("balance").textContent = data.balance.toFixed(2);
    document.getElementById("dailyBudget").value = data.dailyBudget;
    renderLog();
  }

function daysBetween(date1, date2) {
  const d1 = new Date(date1);
  const d2 = new Date(date2);
  return Math.floor((d2 - d1) / (1000 * 60 * 60 * 24));
}

function applyDailyAllowance() {
  const now = new Date();

  // Only apply after 12pm
  if (now.getHours() < 12) return;

  const today = now.toISOString().split("T")[0];

  // First run ever
  if (!data.lastAllowanceDate) {
    data.balance += Number(data.dailyBudget);
    data.lastAllowanceDate = today;
    save();
    return;
  }

  const missedDays = daysBetween(data.lastAllowanceDate, today);

  if (missedDays > 0) {
    data.balance += missedDays * Number(data.dailyBudget);
    data.lastAllowanceDate = today;
    save();
  }
} 

  function addTransaction() {
    const name = document.getElementById("nameInput").value.trim();
    const price = parseFloat(document.getElementById("priceInput").value);

    if (!name || isNaN(price)) return;

    data.balance -= price;
    data.transactions.push({
      id: Date.now(),
      name,
      price
    });

    document.getElementById("nameInput").value = "";
    document.getElementById("priceInput").value = "";

    save();
    updateUI();
  }

  function renderLog() {
    const log = document.getElementById("log");
    log.innerHTML = "";

    data.transactions.forEach((t, index) => {
      const div = document.createElement("div");
      div.className = "entry";

      const nameInput = document.createElement("input");
      nameInput.value = t.name;

      const priceInput = document.createElement("input");
      priceInput.type = "number";
      priceInput.step = "0.01";
      priceInput.value = t.price;

      const saveBtn = document.createElement("button");
      saveBtn.textContent = "Save";
      saveBtn.onclick = () => {
        const oldPrice = t.price;
        t.name = nameInput.value;
        t.price = parseFloat(priceInput.value);
        data.balance += oldPrice - t.price;
        save();
        updateUI();
      };

      const delBtn = document.createElement("button");
      delBtn.textContent = "Del";
      delBtn.onclick = () => {
        data.balance += t.price;
        data.transactions.splice(index, 1);
        save();
        updateUI();
      };

      div.append(nameInput, priceInput, saveBtn, delBtn);
      log.appendChild(div);
    });
  }

  document.getElementById("dailyBudget").addEventListener("change", e => {
    data.dailyBudget = parseFloat(e.target.value);
    save();
  });

  // Initial run
  applyDailyAllowance();
  updateUI();

  // Re-check allowance every minute
  setInterval(() => {
    applyDailyAllowance();
    updateUI();
  }, 60000);
</script>

</body>
</html>
